<!DOCTYPE HTML>
<html xmlns:layout="http://www.w3.org/1999/xhtml"
	layout:decorate="~{etc/fragments/Main_layout}">
<head>
<title>마이페이지-프로필</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
	font-family: "Lato", sans-serif;
}

.sidenav {
	width: 300px;
	position: fixed;
	z-index: 1;
	top: 130px;
	left: 60px;
	background: #eee;
	overflow-x: hidden;
	padding: 8px 0;
	margin-right: 40px;
}

.sidenav a {
	padding: 10px 10px 10px 16px;
	text-decoration: none;
	font-size: 30px;
	color: #2eca6a;
	display: block;
}

.sidenav a:hover {
	color: #064579;
}

.main {
	margin-left: 90px; /* Same width as the sidebar + left position in px */
	padding: 0px 10px;
}

@media screen and (max-height: 450px) {
	.sidenav {
		padding-top: 15px;
	}
	.sidenav a {
		font-size: 30px;
	}
}

#profileContainer {
	margin-left: 400px;
	margin-bottom:200px;
}


/* 모달창  */
/* The Modal (background) */
.modal {
display: none; /* Hidden by default */
position: fixed; /* Stay in place */
z-index: 1; /* Sit on top */
left: 0;
top: 0;
width: 100%; /* Full width */
height: 100%; /* Full height */
overflow: auto; /* Enable scroll if needed */
background-color: rgb(0,0,0); /* Fallback color */
background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}
    
/* Modal Content/Box */
.modal-content {
background-color: #fefefe;
margin: 15% auto; /* 15% from the top and centered */
padding: 20px;
border: 1px solid #888;
width: 50%; /* Could be more or less, depending on screen size */                          
}
/* The Close Button */
.close {
color: #aaa;
float: right;
font-size: 28px;
font-weight: bold;
}
.close:hover,
.close:focus {
color: black;
text-decoration: none;
cursor: pointer;
}

#sidenav{
	background-color:white;
	border: 1px solid #2eca6a;
	color:#2eca6a;
	font-weight:bolder;
	border-radius: 1rem;

}

#title{
	color:#2eca6a;
	font-size:larger;
	font-weight:bolder;
	margin-left:20%;
}
</style>

</head>

<body>

<div layout:fragment="content" class="container">
<br /><br /><br /> <br /> 

<div class="row" id='categoryBar'>
	<div class="col-md-11">
		<div class="sidenav" id='sidenav'>
		  <a th:href="@{/profileMain}">내 프로필</a><br>
		  <a th:href="@{/MyMeetingList}">내 모임</a><br>
		  <a th:href="@{/MyEventList}">내 이벤트</a><br>
		  <a th:href="@{/MyVisitList}">내 방문신청</a><br>
		  <!--<a th:href="@{'/MyVisitList/?memberNumber=}" id="href4">내 방문신청</a>  -->
		</div>
	</div>
</div>

<div class="main">
  <h2 id='title'>내 프로필</h2>
	<div class="container" id="profileContainer">
		<div class='row text-center text-lg-left' id='allGallery'>
				<form action="/profileUpdate" method="post" enctype="multipart/form-data">
					<input type="file" name="uploadFileShot" value="사진변경" id="uploadProfileShot" multiple><br>
					<a class="upload" href="javascript:uploadProfileShot();">프로필변경</a>
				</form><br>
		</div>
	
		<div class='row text-center text-lg-left' id='allGallery'>
			<a class='d-block mb-4 h-100' id='gallery'>
		        <img class='img-fluid img-thumbnail' th:src="${image.imageProfile}" alt="" id='img' style="width:40%; height:40%"><br>
			</a>
		</div>
		<div>
			<div th:each="profile:${profile}">
				<input type="hidden" th:value="${profile.memberNumber}" id="hidden">
				<label for="name">이름: <span th:text='${profile.name}' name='name' id='name'/> </label><br>
				<label for="id">아이디(이메일): <span th:text='${profile.email}' name='email' id='email'/> </label><br>
				<label for="nickname">닉네임: <span th:text='${profile.nickname}' name='nickname' id='nickname'/> </label><br>
				<label for="introduce">자기소개: <span th:text='${profile.introduce}' name='introduce' id='introduce'/> </label><br>
				<label for="grade">회원등급: <span th:text='${profile.grade}' name='grade' id='grade'/> </label><br>
			</div>
		</div>
		<div>
			<div th:each="getPet:${getPet}"> 
				<label for="animal">반려동물: <span th:text='${getPet.animal}' name='animal' id='animal'/> </label><br>
				<label for="amount">마리수: <span th:text='${getPet.amount}' name='amount' id='amount'/> </label><br>
			</div>
		</div>
		<div>
			<input type="button" value="프로필 수정" id="popupButton"> 			
		</div>
	</div>
	
				<!-- modal modal modal modal modal(profileUpdate) -->		
			    <!-- The Modal -->
			    <div id="myProfileModal" class="modal">
				    <!-- Modal content -->
				    <div class="modal-content">
				    	<span class="close">&times;</span>  
				    	<form action="/updateProfileComplete" method="post" id="form">                                                             
				    		<div class="form-group">
								<label for="nickname" class="cols-sm-2 control-label">닉네임</label>
								<div class="cols-sm-10">
									<div class="input-group">
										<span class="input-group-addon"><i class="fa fa-user fa" aria-hidden="true"></i></span> 
										<input type="text" name="nickname" class="form-control"><br>
									</div>
								</div>
								<label for="introduce" class="cols-sm-2 control-label">자기소개</label>
								<div class="cols-sm-10">
									<div class="input-group">
										<span class="input-group-addon"><i class="fa fa-user fa" aria-hidden="true"></i></span> 
										<input type="text" name="introduce" class="form-control"><br>
									</div>
								</div>
								<label for="animal" class="cols-sm-2 control-label">반려동물</label>
								<div class="cols-sm-10">
									<div class="input-group">
										<span class="input-group-addon"><i class="fa fa-user fa" aria-hidden="true"></i></span> 
										<input type="text" name="animal" class="form-control"><br>
									</div>
								</div>
								<label for="animal" class="cols-sm-2 control-label">※반려동물이 없을 시 공백으로 해주세요</label>
							</div>
							
							<div class="form-group">
								<div class="cols-sm-10">
									<div class="input-group">
										<input type="button" name='updateProfileComplete' id="updateProfileComplete" value="수정완료" class="form-control">
										<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"> 
									</div>
								</div>
							</div>
						</form>
				    </div>
			    </div>
				<!-- modal modal modal modal modal(profileUpdate) -->
	
	
	
</div>
<script>

/* var memberNumber= document.getElementById('hidden').value;
$("#href4").on('click',function(){
	$("#href4").prop('href','/MyVisitList/?memberNumber='+memberNumber);
}); */

//Get the modal
var profileModal = document.getElementById('myProfileModal');
var modalButton = document.getElementById('popupButton');
var updateProfile = document.getElementById('updateProfileComplete');

$(modalButton).on('click',function(){
	profileModal.style.display = "block";
});

//Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];                                          

//When the user clicks on <span> (x), close the modal
span.onclick = function() {
    profileModal.style.display = "none";
}

//When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == profileModal) {
        profileModal.style.display = "none";
    }
}


$(updateProfile).on('click',function(){
	memberNumber = $("#hidden").val();
	nickname = $("input[name='nickname']").val();
	introduce = $("input[name='introduce']").val();
	animal = $("input[name='animal']").val();
	
	$.ajax({
		method:'post',
		url:'/updateProfileComplete',
		data:JSON.stringify({'nickname':nickname,'introduce':introduce,'animal':animal,"memberNumber":memberNumber}),
		dataType:"json",
		contentType:"application/json",
		success:function(data){
			location.reload();
		},
		error:function(data){
			alert("error");			
		}
	});
})

//프로필 미리보기
function readURL(input){
	if(input.files && input.files[0]){
		var reader = new FileReader();
	
		reader.onload = function(e){
			$("#img").attr('src',e.target.result);
		}
		reader.readAsDataURL(input.files[0]);
	}
}

$("#uploadProfileShot").change(function(){
	readURL(this);
})

//프로필사진 업데이트
function uploadProfileShot(){
	var formData = new FormData();
	var inputFile = $("input[name='uploadFileShot']");
	var files = inputFile[0].files;
	
	for(var i=0; i<files.length; i++){
		formData.append("uploadFile",files[i]); //uploadFile은 컨트롤러 MultipartFile의 변수명
	}	
	
	alert("form" + form);
	alert("formData" + formData);
	
	$.ajax({
		type:'post',
		url:'/profileUpdate',
		data:formData,
		processData:false,
		contentType:"application/json",
		dataType:'json',
		success:function(result){
			alert("업로드완료");
		},
		error:function(error){
			location.reload();
			alert("업로드실패");
			
		}
	});
}




</script>
</div>
</body>
</html>

