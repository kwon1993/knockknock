<!DOCTYPE HTML>
<html xmlns:layout="http://www.w3.org/1999/xhtml" 
layout:decorate="~{etc/fragments/Main_layout}">
<head>
    <title>낙낙-카테고리 방찾기</title>
<!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
<!-- <meta id="_csrf" name="_csrf" th:content="${_csrf.token}" /> -->
<style>

  .jb-th-1{
  	width : 128px;
  }
  .jb-th-2{
  	width : 50px;
  }

 #jumbotronId { 
	padding: 4rem 0rem;
    margin-bottom: 0rem;
    background-color: white;
    border-radius: 1rem;
 	background-color: white; 
 	font-family: 'Jua', sans-serif;
 	
 }
 #img{
 	width : 200px;
 	height : 150px;
 }
 
</style>

</head>
<body>
	<!-- 전체 레이아웃 -->
	<div layout:fragment="content" class="container">
		<div class="jumbotron" id="jumbotronId">
		 <h1 class="my-4 text-center text-lg-left" id="bang"><strong><span style="color:#2eca6a">취미에</span> 낙낙!</strong></h1>
		 <h3 class="my-4 text-center text-lg-left" id="bang"><strong>관심있는 분야에<span style="color:#2eca6a">&nbsp;체크!</span>&nbsp;해주세요</strong></h3>
			<div class="row">
				<div class="col-4" id="checkField">			   
					<!-- 체크박스 -->
				<div class="checkbox" id="checkboxField">
					<label class="field-title"><h5><strong>관심사</strong></h5></label>
					<div  th:each="theme : ${themeLists}" th:name="branchTheme" th:id="branchTheme">
							<div class="branchTheme"><input type="checkbox" th:value="${theme}" th:id="${theme}" th:name="branchTheme"><label  th:text="${theme}" th:for="${theme}"></label></div>
					</div>
				</div>
				
				<!-- 주소 검색 -->
				<div class="form-group" id="search">
					<label class="field-title"><h5><strong>주소검색</strong></h5></label>
					
						<div id="categorySearch" class="form-group">
							<input type="text" th:name="address"  th:id="address"/>
							<button id="categoryRoomSearch" class="btn btn-outline-success">주소 검색</button>
						</div>
					
				  </div>
				</div>
			
		
		
		<div class="col-7">	
		<div class="table-responsive"  id="categoryGallery">
			<h3 class="my-4 text-center text-lg-left" id="bang"><strong>입주가능<span style="color:#2eca6a">&nbsp;지점</span>&nbsp;목록</strong></h3>
			<table class="table-responsive" id="roomTable">
				<tr  class="text-center">
					<th style="visibility:hidden;"><span style="color:#2eca6a">지점 이미지</span></th>
					<th class="jb-th-1">주소</th>
					<th class="jb-th-2">테마</th>
					<th class="jb-th-2">성별</th>
					<th class="jb-th-1">입주가능 일자</th>
					<th class="jb-th-1">입주가능 인원</th>
				</tr>
			
			  <tbody id="branchDetailVDTOs">			  
				<tr  class="text-center" th:each="branchDetailVDTO : ${lists}">
 	 				<td><a th:href="@{'/roomDetailView/?branchNumber='+${branchDetailVDTO.branchNumber}}" class='d-block mb-4 h-100' id=''>
 	 				<img class='img-responsive img-thumbnail' th:src="'/images/branch/'+${branchDetailVDTO.branchNumber}+'branch.jpg'" alt="branchImg" id='img'>
  	 				<span th:text="'('+${branchDetailVDTO.branchNumber}+호점+')'"></span></a></td>
					<td th:text="${branchDetailVDTO.address}"></td>
					<td th:text="${branchDetailVDTO.theme}"></td>
					<td th:text="${branchDetailVDTO.gender}"></td>
					<td th:text="${branchDetailVDTO.rentableDate}"></td>
					<td th:text="${branchDetailVDTO.allowNumber}"></td>
				
				</tr>
			  </tbody>
			</table>
			</div>	
	  	</div>
<!-- 	  	<div class="pager"> -->
<!-- 	  		<span class="page-number Clickable active">1</span> -->
<!-- 	  		<span class="page-number">2</span> -->
<!-- 	  		<span class="page-number">3</span> -->
<!-- 	  	</div> -->
		</div>
		</div>
		<script>
		
		//카테고리바 체크디자인용
		window.onload = function(){
			$('#categoryFindingRoomNav').addClass('active').css('color','#2eca6a');
		}
		
			var categoryRoom = {

				address : $("#address").val(),
				searchCategory : [],
				refreshGrid : function(data) {
					//todo grid refresh
				},

				sendToServer : function(searchCategory) {
					var that = this;
					var tableList= "";
					var datas = {
						"address" : $("#address").val(),
						"searchKeyWord" : searchCategory
					};
					console.log(datas+" 8888 "+JSON.stringify(datas));	
					$.ajax({
						url : "categoryRoomSearch",
						/* type : 'GET', */
						type : 'POST',
						contentType:"application/json", 
						datatype : "json",
						async : false,
						data : JSON.stringify(datas),
						success : function(branchDetailVDTOs) {
// 							alert("완료!" + branchDetailVDTOs);						
							//기존의 테이블 삭제	
							$('#branchDetailVDTOs tr').remove();
							//each를 통해 테이블 출력
							$.each(branchDetailVDTOs, function(key, branchDetailVDTO) {
								console.log(key + ", " + branchDetailVDTO.theme);
					
								<!--새로 표시할 콘텐츠 집어넣기-->
								$('#branchDetailVDTOs').append(
										"<tr class='text-center' style='width: 30px;'>"
										+"<td><a href='/roomDetailView/?branchNumber="+branchDetailVDTO.branchNumber+"' class='d-block mb-4 h-100' id=''>"
	 									+"<img class='img-thumbnail' src="+"'/images/branch/"+branchDetailVDTO.branchNumber+"branch.jpg'"+" alt='' id='img'/>"
	 									+"<span>"+"("+branchDetailVDTO.branchNumber+"호점)"+"</span>"+"</a></td>"
										+"<td class='address'>"+branchDetailVDTO.address+"</td>"
										+"<td class='theme'>"+branchDetailVDTO.theme+"</td>"
										+"<td class='gender'>"+branchDetailVDTO.gender+"</td>"
										+"<td class='monthlyRent'>"+branchDetailVDTO.rentableDate+"</td>"
										+"<td class='allowNumber'>"+branchDetailVDTO.allowNumber+"</td>"
										+"</tr>");
//  							}
						});
 				},
						error : function(jqXHR, textStatus, errorThrown) {
// 							alert("에러 발생~~ \n" + textStatus + " : "+ errorThrown);

						}
					});
				},

				//a very basic method
				checkboxEventBind : function(target) {
// 					alert("checkboxEventBind target  :" + target);
					var that = this;
				
					 $(target).change(function(e) { 
							that.searchCategory=[];
							
						$("input[name='branchTheme']:checked").each(function(i){
							that.searchCategory[i] = $(this).val();
							//console.log($(this).val()+"  " +that.searchCategory[i]);
						});
						console.log("size:"+that.searchCategory.length);
					/* 	if(that.searchCategory.size==0){
							that.sendToServer(
						}else{ */
							that.sendToServer(that.searchCategory);
						//}
					 }); 
				},
				searchInputEventBind : function(target) {
					var that = this;
					
					$(target).on('click',function(e) {
						that.searchCategory.push($(e.target).val());
// 						alert(e.tatget);
						that.sendToServer(that.searchCategory);
					});
				}
			};
			$(document).ready(function() {
				categoryRoom.checkboxEventBind(".checkbox");
				categoryRoom.searchInputEventBind("#categoryRoomSearch");
			});

			
			
//div class 페이지 나타낼 수  class="pager"
//span 으로 페이지 나타내기 class="page-number clickable active"
//table class="sortable paginated" =>table-responsive
// 			$(document).ready(function(){
// 				$('table.paginated').each(function(){
// 					var currentPage = 0;
// 					var numPerPage = 5;
// 					var $table = $(this);
					
// 					$table.bind('repaginate',function(){
// 						$table.find('tbody tr').hide().slice(currentPage*numPerPage,(currentPage+1)*numPerPage).show();
// 						});
					
// 				var numRows=$table.find('tbody tr').length;
// 				var numPages=Math.ceil(numRows/numPerPage);
// 				var $pager=$('<div class="pager"></div>');
// 				for(var page=0; page<numPages; page++){
// 					$('<span class="page-number"></span>').text(page+1).bind('click',{newPage:page},function(event){
// 						currentPage = event.data['newPage'];
// 					$table.trigger('repaginage');
// 					$(this).addClass('active').siblings().removeClass('active');
// 					}).appendTo($pager).addClass('clickable');
// 				}
// 				$pager.insertBefore($table).find('span.page-number:first').addClass('active';)});
// 			});
		</script>
	</div>
</body>
</html>